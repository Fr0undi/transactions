# Анализ транзакций по банковским картам

## Описание проекта

### 1.1. Разработчики
- Фролов Е.А.
- Будкин Л.А.

### 1.2. Группа
- Д-Э 310

### 1.3. Тема проекта
Анализ данных транзакций по банковским картам с применением методов машинного обучения

### 1.4. Цель проекта
Исследование закономерностей в данных транзакций по банковским картам с использованием методов статистического анализа, машинного обучения и нейронных сетей для выявления паттернов поведения клиентов и классификации транзакций.

### 1.5. Задачи проекта
1. Предобработка данных: приведение к единому формату, устранение пропусков, удаление дубликатов и аномалий;
2. Визуализация данных для выявления основных закономерностей;
3. Корреляционный анализ числовых переменных;
4. Построение регрессионных моделей (простая и множественная линейная регрессия);
5. Классификация транзакций с помощью деревьев решений;
6. Классификация транзакций с помощью алгоритма K ближайших соседей (KNN);
7. Кластерный анализ транзакций методом K-Means;
8. Классификация с применением нейронных сетей;
9. Сравнительный анализ эффективности моделей.

### 1.6. Аннотация
В данном проекте проводится комплексный анализ набора данных о транзакциях по банковским картам. Датасет содержит информацию о более чем миллионе транзакций, включая дату и время, сумму, тип использования карты, информацию о продавце и географическое расположение. 

В ходе исследования применяются методы предобработки данных, визуализации, статистического анализа и машинного обучения. Построены модели классификации для определения крупных транзакций, проведена кластеризация для сегментации транзакций по характеристикам, выполнен регрессионный анализ для прогнозирования суммы транзакции.

## Структура проекта

```
transactions/
├── app/
│   ├── config/
│   │   └── settings.py            # Настройки проекта
│   ├── services/
│   │   └── ml_analysis.py         # Модуль ML-анализа
│   ├── utils/
│   │   └── logger.py              # Настройка логирования
│   ├── main.py                    # Точка входа приложения
│   └── transactions_data.csv      # Исходные данные
├── images/                        # Папка с графиками (создается автоматически)
│   ├── visualization.png
│   ├── correlation_matrix.png
│   ├── regression_analysis.png
│   ├── decision_tree.png
│   ├── knn_classification.png
│   ├── kmeans_clustering.png
│   ├── neural_network.png
│   └── model_comparison.png
├── logs/                          # Папка с логами (создается автоматически)
│   └── analysis.log
├── .venv/                         # Виртуальное окружение Python
├── .gitignore                     # Игнорируемые файлы Git
├── requirements.txt               # Зависимости проекта
└── README.md                      # Описание проекта
```

## Архитектура приложения

Проект организован по модульной архитектуре:

### Модули

**app/main.py** - Точка входа приложения. Запускает основную функцию анализа.

**app/services/ml_analysis.py** - Основной модуль с реализацией всех методов машинного обучения:
- Загрузка и предобработка данных
- Визуализация данных
- Корреляционный анализ
- Регрессионный анализ
- Классификация (деревья решений, KNN, нейронные сети)
- Кластеризация (K-Means)
- Сравнение моделей

**app/config/settings.py** - Конфигурация приложения:
- Пути к файлам и директориям
- Параметры моделей (TEST_SIZE, RANDOM_STATE)
- Настройки логирования
- Размер выборки данных (по умолчанию 100,000 записей)

**app/utils/logger.py** - Настройка логирования:
- Вывод в консоль
- Сохранение в файл logs/analysis.log
- Форматирование сообщений

## Описание данных

| Поле | Описание |
|------|----------|
| id | Уникальный идентификатор транзакции |
| date | Дата и время транзакции |
| client_id | Идентификатор клиента |
| card_id | Идентификатор карты |
| amount | Сумма транзакции |
| use_chip | Тип транзакции (Swipe, Chip, Online) |
| merchant_id | Идентификатор продавца |
| merchant_city | Город продавца |
| merchant_state | Штат продавца |
| zip | Почтовый индекс |
| mcc | Код категории продавца (MCC) |
| errors | Ошибки транзакции |

## Установка и запуск

### Требования
- Python 3.8+
- pip

### Установка зависимостей

Рекомендуется использовать виртуальное окружение:

```bash
# Создание виртуального окружения
python -m venv .venv

# Активация виртуального окружения
# Windows:
.venv\Scripts\activate
# Linux/MacOS:
source .venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt
```

### Запуск анализа

Файл данных `transactions_data.csv` должен находиться в папке `app/`. Для запуска анализа выполните:

```bash
python app/main.py
```

Или через модуль:

```bash
python -m app.main
```

## Методы анализа

### 1. Предобработка данных
- Преобразование типов данных;
- Извлечение временных признаков из даты;
- Обработка пропущенных значений (медиана/мода);
- Удаление дубликатов;
- Обработка выбросов методом IQR (winsorization).

### 2. Визуализация
- Распределение сумм транзакций;
- Анализ по дням недели и часам;
- Географическое распределение;
- Распределение по типам транзакций.

### 3. Корреляционный анализ
- Матрица корреляций Пирсона;
- Выявление значимых связей между переменными.

### 4. Регрессионный анализ
- Простая линейная регрессия (час → сумма);
- Множественная линейная регрессия;
- Метрики: R², RMSE.

### 5. Деревья решений
- Классификация: обычная/крупная транзакция;
- Глубина дерева: 5;
- Анализ важности признаков.

### 6. K ближайших соседей (KNN)
- Подбор оптимального K методом перебора;
- Масштабирование признаков (StandardScaler).

### 7. Кластеризация K-Means
- Метод локтя для выбора числа кластеров;
- Коэффициент силуэта;
- Профилирование кластеров.

### 8. Нейронные сети
- Архитектура: 4 → 64 → 32 → 2;
- Активация: ReLU;
- Оптимизатор: Adam;
- Early stopping.

## Результаты

После выполнения скрипта в папке `images/` будут созданы следующие графики:
- `visualization.png` - общая визуализация данных;
- `correlation_matrix.png` - корреляционная матрица;
- `regression_analysis.png` - результаты регрессии;
- `decision_tree.png` - визуализация дерева решений;
- `knn_classification.png` - результаты KNN;
- `kmeans_clustering.png` - результаты кластеризации;
- `neural_network.png` - результаты нейросети;
- `model_comparison.png` - сравнение моделей.

Логи выполнения сохраняются в `logs/analysis.log`.

## Настройки

Параметры анализа можно изменить в файле `app/config/settings.py`:

```python
SAMPLE_SIZE: int = 100000      # Размер выборки для анализа
TEST_SIZE: float = 0.2         # Доля тестовых данных (20%)
RANDOM_STATE: int = 42         # Seed для воспроизводимости результатов
LOG_LEVEL: str = "INFO"        # Уровень логирования
```

При изменении `SAMPLE_SIZE` анализ будет выполняться на большем или меньшем объеме данных, что влияет на время выполнения и точность моделей.

## Технологии

- **Python 3.8+**
- **pandas** ≥1.5.0 - обработка данных
- **numpy** ≥1.21.0 - численные вычисления
- **matplotlib** ≥3.5.0 - визуализация
- **seaborn** ≥0.12.0 - статистическая визуализация
- **scikit-learn** ≥1.1.0 - машинное обучение
- **openpyxl** ≥3.0.0 - работа с Excel файлами